<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="
    default-src 'self'; 
    script-src 'self' https://code.jquery.com https://cdn.jsdelivr.net https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/ 'unsafe-inline'; 
    object-src 'none'; 
    connect-src 'self'; 
    style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; 
    font-src 'self' https://fonts.gstatic.com; 
    img-src 'self' data: https://*.googleapis.com https://*.ggpht.com; 
    frame-src https://www.google.com/recaptcha/ https://www.google.com/maps/embed/; 
    frame-ancestors 'self'; 
    base-uri 'self'; 
    form-action 'self';">
  	<title>Overruns Sa Tisa Online Shop</title>
  	<link rel="icon" href="images/logo1.png" type="image/x-icon"/>
  	<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
  	<link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
  	<link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  	<link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
   <link rel="stylesheet" href="js/sweetalert2.min.css">
    <link rel="stylesheet" href="js/sweetalert.min.css">

  
    <style type="text/css">

    @media (min-width: 768px){ 
      #navbar-search-input{ 
        width: 60px; 
      }
      #navbar-search-input:focus{ 
        width: 100px; 
      }
      .als-logo{
        width: 100px;
      }
    }
    @media (max-width: 767px) {
    .content-wrapper .container {
        width: 100%;
        padding: 0 15px;
    }
    
    .box-body {
        padding: 10px;
    }
    
    .table-responsive {
        border: none;
    }
    
    #example1 {
        font-size: 12px;
    }
    
    #example1 th, #example1 td {
        padding: 5px;
    }
    
    .btn-sm {
        padding: 2px 5px;
        font-size: 11px;
    }
}

    /* Medium devices (desktops, 992px and up) */
    @media (min-width: 992px){ 
      #navbar-search-input{ 
        width: 150px; 
      }
      #navbar-search-input:focus{ 
        width: 250px; 
      } 
      .als-logo{
        width: 100px;
      }
    }

    .word-wrap{
      overflow-wrap: break-word;
    }
    .prod-body{
      height:300px;
    }

    .box:hover {
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }
    .register-box{
      margin-top:20px;
    }

    #trending{
      list-style: none;
      padding:10px 5px 10px 15px;
    }
    #trending li {
      padding-left: 1.3em;
    }
    #trending li:before {
      content: "\f046";
      font-family: FontAwesome;
      display: inline-block;
      margin-left: -1.3em; 
      width: 1.3em;
    }
    .navbar-width{
      font-size: 100%;
    }
    .box-body-logo {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 3px;
      border-bottom-left-radius: 3px;
      padding: 10px;
      width: 120px;
    }

    /* magnify */
    .show{
      width: 100%;
      height: 100%;
    }
    #show-img{
      width: 100%;
      height: 100%;
    }

    /* image zoom */
    .pic{
      height: 40px;
      width: 40px;
    }

    .picbig{
      position: absolute;
      width: 0px;
      /* margin-top: -20px; */
      margin-left: 10px;
      -webkit-transition: width 0.3s linear 0s;
      transition: width 0.3s linear 0s;
      z-index: 10;
    }

    .pic:hover + .picbig{
      width: 130px;
    }




    .border {
      border: 1px solid #dee2e6 !important
    }

    .p-2 {
      padding: .5rem !important
    }

    .mb-2 {
      margin-bottom: .5rem !important
    }

    .border-bottom {
      borde r-bottom: 1px solid #dee2e6 !important
    }

    .d-inline {
      display: inline !important
    }

    .badge {
      display: inline-block;
      padding: .35em .65em;
      font-size: .75em;
      font-weight: 700;
      line-height: 1;
      color: #fff;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: .25rem
    }

    .badge:empty {
      display: none
      }

    .btn .badge {
      position: relative;
      top: -1px
    }

    .text-dark {
      color: #212529 !important
    }

    .ms-4 {
      margin-left: 1.5rem !important
    }

    .my-2 {
      margin-top: .5rem !important;
      margin-bottom: .5rem !important
    }

    .text-end {
      text-align: right !important
    }

    .mb-1 {
      margin-bottom: .25rem !important
    }

    h6 {
      margin-top: 0;
      margin-bottom: .5rem;
      font-weight: 500;
      line-height: 1.2
    }

    </style>

</head>
<?php
// Function to get the real IP address
function getRealIP() {
    if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
        return $_SERVER['HTTP_CLIENT_IP'];
    } elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
        return explode(',', $_SERVER['HTTP_X_FORWARDED_FOR'])[0];
    } else {
        return $_SERVER['REMOTE_ADDR'];
    }
}

// Path to the file that stores blocked IPs
define('BLOCKED_IP_FILE', __DIR__ . '/blocked_ips.json');

// Time to block (24 hours in seconds)
define('BLOCK_TIME', 24 * 60 * 60);

// Function to check if an IP is blocked
function isIPBlocked($ip) {
    if (!file_exists(BLOCKED_IP_FILE)) {
        return false;
    }

    $blockedIPs = json_decode(file_get_contents(BLOCKED_IP_FILE), true);
    if (isset($blockedIPs[$ip]) && $blockedIPs[$ip] > time()) {
        return true; // Still blocked
    }

    // Remove expired IPs
    if (isset($blockedIPs[$ip]) && $blockedIPs[$ip] <= time()) {
        unset($blockedIPs[$ip]);
        file_put_contents(BLOCKED_IP_FILE, json_encode($blockedIPs));
    }

    return false;
}

// Function to block an IP
function blockIP($ip) {
    $blockedIPs = file_exists(BLOCKED_IP_FILE) ? json_decode(file_get_contents(BLOCKED_IP_FILE), true) : [];
    $blockedIPs[$ip] = time() + BLOCK_TIME;
    file_put_contents(BLOCKED_IP_FILE, json_encode($blockedIPs));
}

// Function to detect malicious activity
function detectMaliciousActivity($ip) {
    // Example: A simple rule to detect multiple requests
   
    if (!isset($_SESSION['request_count'])) {
        $_SESSION['request_count'] = 0;
    }

    $_SESSION['request_count']++;
    if ($_SESSION['request_count'] > 100) { // More than 100 requests in a session
        blockIP($ip);
        return true;
    }

    return false;
}

// Main logic
$ip = getRealIP();
if (isIPBlocked($ip)) {
    header('HTTP/1.1 403 Forbidden');
    exit('Your IP has been temporarily blocked due to suspicious activity.');
}

if (detectMaliciousActivity($ip)) {
    header('HTTP/1.1 403 Forbidden');
    exit('Suspicious activity detected. Your IP has been blocked.');
}
?>